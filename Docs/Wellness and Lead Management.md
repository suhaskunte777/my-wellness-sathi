# Wellness and Lead Management Application 

## Table of Contents
- [Wellness and Lead Management Application](#wellness-and-lead-management-application)
  - [Table of Contents](#table-of-contents)
  - [System Overview](#system-overview)
    - [Application Purpose](#application-purpose)
    - [Core Functionalities](#core-functionalities)
  - [Technology Stack](#technology-stack)
    - [Backend Framework](#backend-framework)
    - [Backend Development Tools](#backend-development-tools)
    - [Frontend Framework \& Packages](#frontend-framework--packages)
  - [User Authentication](#user-authentication)
  - [User Roles \& Permissions](#user-roles--permissions)
    - [Package for User and Access Management](#package-for-user-and-access-management)
    - [Primary Roles](#primary-roles)
    - [Access Control \& Permission Structure (RBAC + ABAC)](#access-control--permission-structure-rbac--abac)
  - [User and Related Migrations](#user-and-related-migrations)
    - [Core User Migration](#core-user-migration)
    - [Required Spatie Permission Migrations](#required-spatie-permission-migrations)
    - [Required Spatie Tags Migrations](#required-spatie-tags-migrations)
    - [Laravel Sanctum Migration](#laravel-sanctum-migration)
    - [Password Reset Migration](#password-reset-migration)
    - [Laravel Auditing Migration](#laravel-auditing-migration)
  - [Permission Definitions](#permission-definitions)
    - [Core Permissions](#core-permissions)
    - [Role-Permission Mappings](#role-permission-mappings)
  - [Security Considerations](#security-considerations)
    - [Password Policy](#password-policy)
    - [Token Management](#token-management)
    - [Rate Limiting](#rate-limiting)
    - [Audit Trail](#audit-trail)
  - [API Authentication Endpoints](#api-authentication-endpoints)
  - [Prospect and Related Migrations](#prospect-and-related-migrations)
  - [User and Prospect Shared Migritions](#user-and-prospect-shared-migritions)
    - [Profile Details](#profile-details)
    - [User Groups](#user-groups)
    - [Marketing Level](#marketing-level)
    - [Contacts](#contacts)
    - [Addresses](#addresses)
    - [Photos](#photos)
    - [Health](#health)
  - [Activities](#activities)
  - [Stock Management System](#stock-management-system)
    - [Core Concepts](#core-concepts)
    - [Database Schema](#database-schema)
    - [Key Features](#key-features)
    - [Business Logic](#business-logic)
    - [API Endpoints](#api-endpoints)
  - [Club Management System](#club-management-system)
      - [Shake Counter Implementation:](#shake-counter-implementation)
  - [Implementation Status](#implementation-status)
    - [âœ… Completed Features](#-completed-features)
    - [ðŸš§ In Progress / Planned Features](#-in-progress--planned-features)

## System Overview

### Application Purpose
A comprehensive wellness industry platform serving four primary user types:
- **Coaches**: Wellness professionals who help others achieve health goals
- **Members**: Individuals progressing toward health goals
- **Mentors**: Primarily Coaches but also successful business leaders providing guidance
- **Guest**: Individuals who are prospect members of the organization, they are not registered yet so can't access any content. Those added by admin or coach will be called as Guest. Can be converted to member by admin or coach, once they take our product/program/service.

### Core Functionalities
- User Authentication and Authorization
- Prospect management and tracking 
- Member measurement and tracking
- Club Management and attendance
- Stock and inventory management
- Financial tracking and reporting
- Assessment, survey, TTP and Camp tools 
- Product/Service/Program/Batch management
- Marketing level management
- Communication and notification systems

## Technology Stack

- Backend is API only for application
- Also backend will have some UI for Horizon and Pulse
- Frontend will be Separate repository based on Quasar
- we will use uuid wherever data is getting generated by user, to facilitate offline creation of records.
- Models which only can create in online mode or not created by user can still continue using bigint id.
- SoftDelete all the tables, if excepting any table mention specifically why softDelete is not required their.
- Application should support dark mode (using Quasar)
- Use Quasar css classes for styling

### Backend Framework
- **Laravel 12** with PHP 8.4
- **MySQL 8.0+** for primary database
- **Redis** for caching and session management
- **Laravel Sanctum** for API authentication
- **Laravel Auditing** for audit trails
- **Spatie Laravel Permission** for RBAC
- **Spatie Laravel Tags** for tags ABAC
- **Laravel Backup** for data backup
- **Laravel Telescope** for debugging
- **Laravel Horizon** for queue management
- **Laravel Pulse** for application monitoring

### Backend Development Tools
- **Laravel Pail** for file storage
- **Laravel Pint** for code formatting
- **Larastan** for static analysis
- **PHPUnit** for testing
- **Laravel IDE Helper** for development assistance

### Frontend Framework & Packages
- **Vue.js 4** 
- **Node.js 22**
- **PNPM** for package management
- **Quasar framework 2.18**
- **Vue router**
- **Pinia** Store Management
- **Axios** 
- **vcards-js**
- **dayjs**
- **html2pdf.js**
- **uuid** - for uuid generation

## User Authentication

- Use Token based authentication provided by *laravel/sanctum*
- User may have same email and mobile for multiple accounts
- We will use username (Unique across users) and password for authentication
- User belongs to family for viewing / switching other profiles
- Frontend should have quick profile switching support for authenticated user as Google provides for Gmail, Maps etc.
- For forget password, use username along with birth date and email.
- For forget username, use birth date, email, herbalife ID
- User only be created by invitation only

## User Roles & Permissions

### Package for User and Access Management
- Use *laravel/sanctum* for token based authentication (not cookie based)
- Use *spatie/laravel-permission* package for Role and Permission Management
- Use *spatie/laravel-tags* package for Tag Management

### Primary Roles
1. **Super Admin** - Full system access (Only one seeded by seeders)
2. **Admin** - Organization-level management (User is admin for his Organization. User will get manage organization feature after Active World Team. User org is members joined by him and his downline members)
3. **Mentor** - Business leadership and guidance (User is above GET marketing level is called as mentor)
4. **Coach** - Wellness coaching and member management (User in helping others to achieve their health goals is called as coach until they achieve GET marketing level)
5. **Member** - Personal wellness journey tracking (User is tracking their own wellness journey)
6. **Guest** - Limited access for assessments (User is not a member of the organization)

### Access Control & Permission Structure (RBAC + ABAC)

- Role Based Access Control
  - Used for Create, Update and Delete permission

- Attribute Based Access Control
  - Used for view can view given Model (data)
  - Tags will be used as attribute to control this behavior
  - User Groups will be assigned tags

## User and Related Migrations

### Core User Migration
```php
Schema::create('users', function (Blueprint $table) {
    $table->uuid('uuid')->primary();
    $table->string('name');
    $table->date('birth_date');
    $table->string('herbalife_id')->nullable();
    $table->boolean('business_owner')->default(0);
    $table->string('username')->unique();
    $table->string('email');
    $table->timestamp('email_verified_at')->nullable();
    $table->string('mobile');
    $table->timestamp('mobile_verified_at')->nullable();
    $table->string('password');
    $table->boolean('is_admin')->default(false);
    $table->foreignUuid('invited_by')->nullable()->constrained('users', 'uuid')->onDelete('set null');
    $table->foreignUuid('created_by')->nullable()->constrained('users', 'uuid')->onDelete('cascade');
    $table->rememberToken();
    $table->timestamps();
    $table->softDeletes();
});
```

### Required Spatie Permission Migrations
 - We will use default tables from spatie/laravel-permission

### Required Spatie Tags Migrations
- Use spatie/laravel-tags default tags tables

### Laravel Sanctum Migration
```php
Schema::create('personal_access_tokens', function (Blueprint $table) {
    $table->id();
    $table->morphs('tokenable');
    $table->string('name');
    $table->string('type');
    $table->string('hash', 64)->unique();
    $table->text('abilities')->nullable();
    $table->timestamp('last_used_at')->nullable();
    $table->timestamp('expires_at')->nullable();
    $table->timestamps();
});
```

### Password Reset Migration
```php
Schema::create('password_reset_tokens', function (Blueprint $table) {
    $table->string('username')->primary();
    $table->string('token');
    $table->timestamp('created_at')->nullable();
});
```

### Laravel Auditing Migration
- We will use default migration from auditing package.

## Permission Definitions

### Core Permissions
```php
// Create permissions
'create.all', 'create.own'

// Update permissions  
'update.all', 'update.own'

// Delete permissions
'delete.all', 'delete.own'

// Destroy permission (only for super admin)
'destroy.all'
```

### Role-Permission Mappings
```php
// Super Admin - All permissions
'Super Admin' => ['create.all', 'update.all', 'delete.all', 'destroy.all']

// Mentor - can create all, update all, delete all, but cannot destroy
'Mentor' => ['create.all', 'update.all', 'delete.all']

// Coach - can create own, update own/all, delete own
'Coach' => ['create.own', 'update.own', 'update.all', 'delete.own']

// Member - can create own, update own, delete own
'Member' => ['create.own', 'update.own', 'delete.own']

// Guest - no write permissions, will use ABAC for read access
'Guest' => []
```

## Security Considerations

### Password Policy
- Minimum 8 characters
- Must contain uppercase, lowercase, number, and special character
- Password history: 3 previous passwords
- Password expiration: 90 days

### Token Management
- Access token expiration: 24 hours
- Refresh token expiration: 30 days
- Maximum active tokens per user: 3

### Rate Limiting
- Login attempts: 5 per 15 minutes
- API requests: 1000 per hour per user
- Password reset: 3 per hour per email

### Audit Trail
- All user actions logged
- Sensitive operations require additional verification
- Failed authentication attempts logged
- Token usage tracked

## API Authentication Endpoints

**Currently Implemented:**
```php
// Authentication Routes
POST /api/register  (invitation only)
POST /api/login
POST /api/logout
POST /api/forgot-password
POST /api/forgot-username
POST /api/reset-password
GET /api/verify-email/{id}/{hash}
POST /api/email/verification-notification
```

**API Resource Endpoints:**
```php
// Prospect Management
GET /api/prospects
POST /api/prospects
GET /api/prospects/{prospect}
PUT /api/prospects/{prospect}
DELETE /api/prospects/{prospect}
GET /api/prospects/needs-follow-up
GET /api/prospects/by-lead-stage/{stage}
POST /api/prospects/{prospect}/convert

// Profile Details Management
GET /api/profile-details
POST /api/profile-details
GET /api/profile-details/{profileDetail}
PUT /api/profile-details/{profileDetail}
DELETE /api/profile-details/{profileDetail}
GET /api/profile-details/by-user/{userUuid}
GET /api/profile-details/needs-follow-up
POST /api/profile-details/convert-from-prospect/{prospectUuid}/{userUuid}

// Health Data Management
GET /api/health-data
POST /api/health-data
GET /api/health-data/{healthData}
PUT /api/health-data/{healthData}
DELETE /api/health-data/{healthData}

// Measurement Management
GET /api/measurements
POST /api/measurements
GET /api/measurements/{measurement}
PUT /api/measurements/{measurement}
DELETE /api/measurements/{measurement}

// Daily Tracker Management
GET /api/daily-trackers
POST /api/daily-trackers
GET /api/daily-trackers/{dailyTracker}
PUT /api/daily-trackers/{dailyTracker}
DELETE /api/daily-trackers/{dailyTracker}
GET /api/daily-trackers/by-date
POST /api/daily-trackers/{dailyTracker}/validate

// Product Management
GET /api/products
POST /api/products
GET /api/products/{product}
PUT /api/products/{product}
DELETE /api/products/{product}

// Stock Location Management
GET /api/stock-locations
POST /api/stock-locations
GET /api/stock-locations/{stockLocation}
PUT /api/stock-locations/{stockLocation}
DELETE /api/stock-locations/{stockLocation}

// Company Invoice Management
GET /api/company-invoices
POST /api/company-invoices
GET /api/company-invoices/{invoice}
PUT /api/company-invoices/{invoice}
DELETE /api/company-invoices/{invoice}
POST /api/company-invoices/{invoice}/verify

// Invoice Items Management
GET /api/invoice-items
POST /api/invoice-items
GET /api/invoice-items/{item}
PUT /api/invoice-items/{item}
DELETE /api/invoice-items/{item}
GET /api/invoice-items/by-invoice/{invoiceUuid}

// Stock Batch Management
GET /api/stock-batches
POST /api/stock-batches
GET /api/stock-batches/{batch}
PUT /api/stock-batches/{batch}
DELETE /api/stock-batches/{batch}
GET /api/stock-batches/by-location/{locationUuid}
GET /api/stock-batches/by-product/{productUuid}
GET /api/stock-batches/expiring-soon

// Stock Movement Management
GET /api/stock-movements
POST /api/stock-movements
GET /api/stock-movements/{movement}
PUT /api/stock-movements/{movement}
DELETE /api/stock-movements/{movement}
GET /api/stock-movements/by-location/{locationUuid}
GET /api/stock-movements/by-type/{type}
POST /api/stock-movements/{movement}/approve

// Stock Reservation Management
GET /api/stock-reservations
POST /api/stock-reservations
GET /api/stock-reservations/{reservation}
PUT /api/stock-reservations/{reservation}
DELETE /api/stock-reservations/{reservation}
GET /api/stock-reservations/by-customer/{customerUuid}
POST /api/stock-reservations/{reservation}/fulfill

// Stock Valuation Management
GET /api/stock-valuations
POST /api/stock-valuations
GET /api/stock-valuations/{valuation}
PUT /api/stock-valuations/{valuation}
DELETE /api/stock-valuations/{valuation}
GET /api/stock-valuations/by-location/{locationUuid}
GET /api/stock-valuations/profit-loss-report

// Club Management
GET /api/clubs
POST /api/clubs
GET /api/clubs/{club}
PUT /api/clubs/{club}
DELETE /api/clubs/{club}
GET /api/clubs/by-owner/{ownerId}

// Club Memberships Management
GET /api/club-memberships
POST /api/club-memberships
GET /api/club-memberships/{clubMembership}
PUT /api/club-memberships/{clubMembership}
DELETE /api/club-memberships/{clubMembership}
GET /api/club-memberships/by-club/{clubId}
GET /api/club-memberships/by-user/{userId}

// Shake Combinations Management
GET /api/shake-combinations
POST /api/shake-combinations
GET /api/shake-combinations/{shakeCombination}
PUT /api/shake-combinations/{shakeCombination}
DELETE /api/shake-combinations/{shakeCombination}

// Club Shake Counter Management
GET /api/club-shake-counter
POST /api/club-shake-counter
GET /api/club-shake-counter/{clubShakeCounter}
PUT /api/club-shake-counter/{clubShakeCounter}
DELETE /api/club-shake-counter/{clubShakeCounter}
GET /api/club-shake-counter/by-club/{clubId}
GET /api/club-shake-counter/by-date/{date}
```

## Prospect and Related Migrations

```php
Schema::create('prospects', function (Blueprint $table) {
    $table->uuid('uuid')->primary();
    $table->string('name');
    $table->string('primary_phone')->nullable();
    $table->date('birth_date')->nullable();
    $table->unsignedSmallInteger('birth_year')->nullable();
    $table->unsignedTinyInteger('age')->nullable();
    $table->enum('age_by', ['birth_date', 'birth_year', 'age'])->nullable();
    $table->unsignedTinyInteger('height')->nullable();
    $table->enum('gender', ['male', 'female', 'other'])->nullable();
    $table->enum('marital_status', ['single', 'married', 'divorced', 'widowed'])->nullable();
    $table->enum('occupation', ['student', 'employed', 'unemployed', 'retired', 'housewife', 'other'])->nullable();
    $table->string('mother_tongue', 25)->nullable();
    $table->enum('source', ['TTP', 'Assessment', 'Measurement_Camp', 'Referral', 'Paper_Insert', 'Circular_of_Influence', 'Social_Media', 'Advertisement', 'Walk_In', 'Other'])->nullable();
    $table->string('source_details', 191)->nullable();
    $table->enum('lead_stage', ['New', 'Contacted', 'Interested', 'Qualified', 'Converted', 'Lost', 'Hold', 'Archived'])->nullable();
    $table->string('referred_by', 36)->nullable();
    $table->string('notes')->nullable();
    $table->date('last_follow_up_date')->nullable();
    $table->date('next_follow_up_date')->nullable();

    $table->string('health_challenge', 255)->nullable();
    $table->string('medication', 255)->nullable();
    $table->string('health_goal', 255)->nullable();
    
    $table->unsignedTinyInteger('conversion_probability')->nullable();
    $table->string('converted_to_user_uuid', 36)->nullable();
    $table->timestamp('converted_at')->nullable();
    $table->boolean('is_active')->default(true);

    $table->foreignUuid('created_by')->nullable()->constrained('users', 'uuid')->onDelete('cascade');
    $table->foreignUuid('updated_by')->nullable()->constrained('users', 'uuid')->onDelete('cascade');
    $table->foreignUuid('deleted_by')->nullable()->constrained('users', 'uuid')->onDelete('cascade');
    $table->foreignUuid('coach_id')->nullable()->constrained('users', 'uuid')->onDelete('cascade');

    $table->timestamps();
    $table->softDeletes();
    
    // Performance indexes
    $table->index(['lead_stage', 'is_active']);
    $table->index(['coach_id', 'is_active']);
    $table->index(['created_by', 'is_active']);
    $table->index(['next_follow_up_date']);
    $table->index(['converted_to_user_uuid']);
});
```


## User and Prospect Shared Migritions

### Profile Details
```php
Schema::create('profile_details', function (Blueprint $table) {
    $table->uuid('uuid')->primary();
    $table->foreignUuid('user_uuid')->constrained('users', 'uuid')->onDelete('cascade');
    $table->string('first_name', 191)->nullable();
    $table->string('middle_name', 191)->nullable();
    $table->string('last_name', 191)->nullable();
    $table->string('primary_email', 50)->nullable();
    $table->string('primary_phone', 18)->nullable();
    $table->date('birth_date')->nullable();
    $table->unsignedSmallInteger('birth_year')->nullable();
    $table->unsignedTinyInteger('age')->nullable();
    $table->enum('age_by', ['birth_date', 'birth_year', 'age'])->nullable();
    $table->enum('gender', ['male', 'female', 'other'])->nullable();
    $table->enum('marital_status', ['single', 'married', 'divorced', 'widowed'])->nullable();
    $table->enum('source', ['TTP', 'Assessment', 'Measurement_Camp', 'Referral', 'Paper_Insert', 'Circular_of_Influence', 'Social_Media', 'Advertisement', 'Walk_In', 'Other'])->nullable();
    $table->string('source_details', 191)->nullable();
    $table->string('occupation', 191)->nullable();
    $table->string('mother_tongue', 25)->nullable();
    $table->string('notes')->nullable();
    $table->date('last_follow_up_date')->nullable();
    $table->date('next_follow_up_date')->nullable();
    $table->string('converted_from_prospect_uuid', 36)->nullable();
    $table->timestamp('converted_at')->nullable();
    
    $table->enum('marketing_level', ['Guest', 'Preferred_Customer', 'Associate', 'Senior_Consultant', 'Success_Builder', 'Supervisor', 'Active_Supervisor', 'World_Team', 'Active_World_Team', 'GET', 'GET 2500','MIL', 'MIL 7500', 'PRESIDENT TEAM', 'Executive Presidents Team', 'Senior Executive Presidents Team', 'International Executive Presidents Team', 'Chief Executive Presidents Team', 'Chairmans Club', 'Founder Circle' ])->default('Guest');
    $table->unsignedTinyInteger('diamonds')->nullable();
    $table->unsignedTinyInteger('stones')->nullable();
    $table->unsignedTinyInteger('royalty_level')->nullable();
    $table->unsignedTinyInteger('discount_level')->default(0);
    $table->unsignedTinyInteger('years_active')->default(0);
    $table->unsignedTinyInteger('mark_hughes_award')->default(0);

    $table->boolean('is_active')->default(true);
    $table->foreignUuid('coach_id')->nullable()->constrained('users', 'uuid')->onDelete('cascade');
    $table->foreignUuid('referred_by')->nullable()->constrained('users', 'uuid')->onDelete('cascade');
    $table->foreignUuid('supervisor_id')->nullable()->constrained('users', 'uuid')->onDelete('cascade');
    $table->foreignUuid('world_team_id')->nullable()->constrained('users', 'uuid')->onDelete('cascade');
    $table->foreignUuid('get_id')->nullable()->constrained('users', 'uuid')->onDelete('cascade');
    $table->foreignUuid('mil_id')->nullable()->constrained('users', 'uuid')->onDelete('cascade');
    $table->foreignUuid('president_team_id')->nullable()->constrained('users', 'uuid')->onDelete('cascade');
    $table->foreignUuid('created_by')->nullable()->constrained('users', 'uuid')->onDelete('cascade');
    $table->foreignUuid('updated_by')->nullable()->constrained('users', 'uuid')->onDelete('cascade');
    $table->foreignUuid('deleted_by')->nullable()->constrained('users', 'uuid')->onDelete('cascade');
    
    $table->timestamps();
    $table->softDeletes();
    
    // Performance indexes
    $table->index(['user_uuid', 'is_active']);
    $table->index(['coach_id', 'is_active']);
    $table->index(['created_by', 'is_active']);
    $table->index(['next_follow_up_date']);
    $table->index(['converted_from_prospect_uuid']);
});
```

### User Groups

```php
Schema::create('groups', function (Blueprint $table) {
    $table->uuid('uuid')->primary();
    $table->string('groupable_type', 191)->nullable(); // User or Club or Prospect
    $table->string('groupable_id', 36)->nullable(); // User or Club or Prospect ID
    $table->string('name')->notNull();
    $table->string('description')->nullable();
    $table->enum('type', ['marketing_level', 'coach_hierarchy', 'club', 'non-supervisor', 'batch', 'demographic', 'program_batch', 'custom'])->notNull();
    $table->string('custom_type')->nullable();
    $table->string('group_code')->nullable()->unique();
    $table->json('criteria')->nullable();
    $table->boolean('auto_assign')->default(false);
    $table->boolean('is_active')->default(true);
    $table->foreignUuid('created_by')->nullable()->constrained('users', 'uuid')->onDelete('cascade');
    $table->foreignUuid('updated_by')->nullable()->constrained('users', 'uuid')->onDelete('cascade');
    $table->foreignUuid('deleted_by')->nullable()->constrained('users', 'uuid')->onDelete('cascade');
    $table->timestamps();
    $table->softDeletes();
    
    // Performance indexes
    $table->index(['groupable_type', 'groupable_id']);
    $table->index(['type', 'is_active']);
    $table->index(['created_by', 'is_active']);
});
```

- **User Auto assing Groups Criteria**
  - marketing_level
    - Based on marketing level, assing the group to the user.
  - club
    - Based on club, assing the group to the user.
  - All non-supervisor users
    - Users belogns to 'Associate', 'Senior_Consultant', 'Success_Builder' marketing level are called as non-supervisor.
  - All supervisor users
    - Users belogns to 'Supervisor' and above marketing level are called as supervisor.
  - All TAB team users all 
    - Users belogns to GET and above till MIL7500 marketing level are called as TAB team.
  - All President team users
    - Users belogns to 'President Team', 'Executive Presidents Team', 'Senior Executive Presidents Team', 'International Executive Presidents Team', 'Chief Executive Presidents Team', 'Chairmans Club', 'Founder Circle' marketing level are called as President team.


### Marketing Level 

- This is a fix value table, feel with seeding only. And can be keep long cached.
```php
Schema::create('marketing_levels', function (Blueprint $table) {
    $table->id();
    $table->integer('level')->unique();
    $table->string('name')->index();
    $table->timestamps();
});
```


### Contacts

- All contacts with country code, email format, phone format, etc. should be validated during input. if not available in laravel inbuilt, then use its ecosystem or third party package.

```php
Schema::create('contacts', function (Blueprint $table) {
    $table->uuid('uuid')->primary();
    $table->string('contactable_type', 191)->nullable(); // User or Club
    $table->string('contactable_id', 36)->nullable(); // User or Club ID
    $table->enum('type', ['Mobile', 'TelePhone', 'WhatsApp', 'Email', 'Facebook', 'Instagram', 'YouTube', 'Telegram', 'Other', 'WhatsApp Business', 'WhatsApp Personal', 'Custom'])->default('Mobile');
    $table->string('custom_type')->nullable();
    $table->string('value')->notNull();
    $table->boolean('is_primary')->default(false);
    $table->boolean('is_verified')->default(false);
    $table->string('tags')->nullable();
    $table->foreignUuid('created_by')->nullable()->constrained('users', 'uuid')->onDelete('cascade');
    $table->foreignUuid('updated_by')->nullable()->constrained('users', 'uuid')->onDelete('cascade');
    $table->foreignUuid('deleted_by')->nullable()->constrained('users', 'uuid')->onDelete('cascade');
    $table->timestamps();
    $table->softDeletes();
    
    // Performance indexes
    $table->index(['contactable_type', 'contactable_id']);
    $table->index(['type', 'is_primary']);
    $table->index(['is_verified']);
});
```

### Addresses

- As we dont have all city, taluka, district, state, country, pincode in our system, we need to use any third party service to get this verified or also strip, capitalization, etc. during input validation. check if laravel or its ecosystem or third party has any package for this.
- If google map link is provided, then can we get latitude and longitude from it without any cost? if yes, then we can use it.
- Also can we get city, taluka, district, state, country, pincode from google map link without any cost? if yes, then we can use it.

```php  
Schema::create('addresses', function (Blueprint $table) {
    $table->uuid('uuid')->primary();
    $table->string('addressable_type', 191)->nullable(); // User or Club
    $table->string('addressable_id', 36)->nullable(); // User or Club ID
    $table->enum('type', ['home', 'office', 'club', 'temporary', 'other', 'custom'])->default('home');
    $table->string('address_name')->nullable();
    $table->string('address_line_1')->notNull();
    $table->string('address_line_2')->nullable();
    $table->string('city')->notNull();
    $table->string('taluka')->nullable();
    $table->string('district')->notNull();
    $table->string('state')->notNull();
    $table->string('country')->notNull()->default('India');
    $table->string('pincode')->notNull();
    $table->string('google_map_link')->nullable();
    $table->decimal('latitude', 11, 8)->nullable();
    $table->decimal('longitude', 11, 8)->nullable();
    $table->boolean('is_primary')->default(false);
    $table->foreignUuid('created_by')->nullable()->constrained('users', 'uuid')->onDelete('cascade');
    $table->foreignUuid('updated_by')->nullable()->constrained('users', 'uuid')->onDelete('cascade');
    $table->foreignUuid('deleted_by')->nullable()->constrained('users', 'uuid')->onDelete('cascade');
    $table->timestamps();
    $table->softDeletes();
    
    // Performance indexes
    $table->index(['addressable_type', 'addressable_id']);
    $table->index(['type', 'is_primary']);
    $table->index(['city', 'state']);
    $table->index(['pincode']);
    $table->index(['latitude', 'longitude']);
});
```

### Photos

- All photos should be stored in storage/app/public/photos/user_photos/
- We should have a library or package to compress the photo before storing in database without losing quality.
- photos should have expiry date, after which it will be deleted from database and storage.
- frontend we can use some library to identify the photo type and suggest it accordingly.

```php 
Schema::create('photos', function (Blueprint $table) {
    $table->uuid('uuid')->primary();
    $table->string('photoable_type', 191)->nullable(); // User or Club or Prospect
    $table->string('photoable_id', 36)->nullable(); // User or Club or Prospect ID
    $table->enum('type', ['Profile', 'Front', 'Back', 'Left', 'Right', 'Full_body', 'Measurement', 'Shake', 'Afresh', 'Skin_Booster', 'H24_Hydrate', 'H24_Rebuild', 'Sleep_Enhancer', 'Niteworks', 'Beta_Heart', 'Tablet',  'Meal', 'Snacks', 'Activity_Proof', 'Custom'])->notNull();
    $table->string('custom_type')->nullable();
    $table->string('file_path', 500)->notNull();
    $table->string('file_name', 255)->notNull();
    $table->integer('file_size')->notNull();
    $table->string('mime_type', 100)->notNull();
    $table->string('caption')->nullable();
    $table->timestamp('taken_at')->nullable();
    $table->decimal('latitude', 10, 8)->nullable();
    $table->decimal('longitude', 11, 8)->nullable();
    $table->boolean('is_primary')->default(false);
    $table->string('tags')->nullable();
    $table->foreignUuid('created_by')->nullable()->constrained('users', 'uuid')->onDelete('cascade');
    $table->foreignUuid('updated_by')->nullable()->constrained('users', 'uuid')->onDelete('cascade');
    $table->foreignUuid('deleted_by')->nullable()->constrained('users', 'uuid')->onDelete('cascade');
    $table->timestamps();
    $table->softDeletes();
    
    // Performance indexes
    $table->index(['photoable_type', 'photoable_id']);
    $table->index(['type', 'is_primary']);
    $table->index(['file_path']);
    $table->index(['taken_at']);
    $table->index(['latitude', 'longitude']);
});
```

### Health

```php
Schema::create('health_data', function (Blueprint $table) {
    $table->uuid('uuid')->primary();
    $table->string('health_dataable_type', 191)->nullable(); // User or Prospect
    $table->string('health_dataable_id', 36)->nullable(); // User or Prospect ID
    $table->string('challenges')->nullable();
    $table->string('goals')->nullable();
    $table->string('medical_history')->nullable();
    $table->string('current_medications')->nullable();
    $table->string('allergies')->nullable();
    $table->string('dietary_restrictions')->nullable();
    $table->enum('fitness_level', ['beginner', 'intermediate', 'advanced'])->nullable();
    $table->foreignUuid('created_by')->nullable()->constrained('users', 'uuid')->onDelete('cascade');
    $table->foreignUuid('updated_by')->nullable()->constrained('users', 'uuid')->onDelete('cascade');
    $table->foreignUuid('deleted_by')->nullable()->constrained('users', 'uuid')->onDelete('cascade');
    $table->timestamps();
    $table->softDeletes();
});
```

```php
Schema::create('measurements', function (Blueprint $table) {
    $table->uuid('uuid')->primary();
    $table->string('measurementable_type', 191)->nullable(); // User or Prospect
    $table->string('measurementable_id', 36)->nullable(); // User or Prospect ID
    $table->enum('condition', ['Empty Stomach', 'After Breakfast', 'After Lunch', 'After Dinner', '2 Hours After Meal', '1 Hour after Breakfast'])->nullable();
    $table->unsignedTinyInteger('age')->nullable();
    $table->decimal('height', 5, 2)->nullable();
    $table->decimal('weight', 5, 2)->nullable();
    $table->decimal('body_fat', 5, 2)->nullable();
    $table->decimal('bmi', 5, 2)->nullable();
    $table->decimal('visceral_fat', 5, 2)->nullable();
    $table->unsignedSmallInteger('bmr_resting')->nullable();
    $table->unsignedTinyInteger('body_age')->nullable();
    $table->decimal('trunk_fat', 5, 2)->nullable();
    $table->decimal('muscle_mass', 5, 2)->nullable();
    $table->decimal('belly_inches_top', 5, 2)->nullable();
    $table->decimal('belly_inches_bottom', 5, 2)->nullable();
    $table->string('notes')->nullable();
    $table->foreignUuid('created_by')->nullable()->constrained('users', 'uuid')->onDelete('cascade');
    $table->foreignUuid('updated_by')->nullable()->constrained('users', 'uuid')->onDelete('cascade');
    $table->foreignUuid('deleted_by')->nullable()->constrained('users', 'uuid')->onDelete('cascade');
    $table->timestamps();
    $table->softDeletes();
    
    // Performance indexes
    $table->index(['measurementable_type', 'measurementable_id']);
    $table->index(['created_by']);
});
```


```php
Schema::create('daily_trackers', function (Blueprint $table) {
    $table->uuid('uuid')->primary();
    $table->foreignUuid('user_uuid')->constrained('users', 'uuid')->onDelete('cascade');
    $table->date('date')->index();
    // Fixed daily data fields
    $table->integer('water_intake')->default(0); // in ml
    $table->decimal('sleep_hours', 3, 1)->default(0); // in hours
    $table->boolean('exercise_done')->default(false);
    $table->integer('exercise_duration')->default(0); // in minutes
    $table->integer('mood_rating')->default(0); // 1-10 scale
    $table->integer('mindset_rating')->default(0); // 1-10 scale
    $table->integer('energy_level')->default(0); // 1-10 scale
    $table->integer('streak_count')->default(0);
    $table->boolean('is_validated')->default(false);
    // Validation and notes
    $table->string('notes')->nullable();
    $table->foreignUuid('validated_by')->nullable()->constrained('users', 'uuid')->onDelete('cascade')->index();
    $table->timestamp('validated_at')->nullable();
    // Audit fields
    $table->foreignUuid('created_by')->nullable()->constrained('users', 'uuid')->onDelete('cascade')->index();
    $table->foreignUuid('updated_by')->nullable()->constrained('users', 'uuid')->onDelete('cascade');
    $table->foreignUuid('deleted_by')->nullable()->constrained('users', 'uuid')->onDelete('cascade');
    $table->timestamps();
    $table->softDeletes();
    // Performance indexes
    $table->unique(['user_uuid', 'date']);
});
```

```php
Schema::create('daily_tracker_intakes', function (Blueprint $table) {
    $table->uuid('uuid')->primary();
    $table->foreignUuid('daily_tracker_uuid')->constrained('daily_trackers', 'uuid')->onDelete('cascade')->index();

            // Supplement intake details
    $table->enum('supplement_type', [
        'Shake',
        'Afresh',
        'Detox',
        'Skin Booster',
        'Niteworks',
        'Sleep Enhancer',
        'Meal',
        'Beta Heart',
        'Joint Support',
        'Probiotics',
        'Multivitamins',
        'Herbalifeline',
        'Other'
    ])->index();
    $table->string('supplement_name')->nullable();

    $table->timestamp('taken_at')->index();
    $table->decimal('quantity', 10, 2)->default(1); // For servings devided in multiple persons/parts
    $table->string('notes')->nullable(); // Optional notes for this specific intake

    // Audit fields
    $table->foreignUuid('created_by')->nullable()->constrained('users', 'uuid')->onDelete('cascade')->index();
    $table->foreignUuid('updated_by')->nullable()->constrained('users', 'uuid')->onDelete('cascade');
    $table->foreignUuid('deleted_by')->nullable()->constrained('users', 'uuid')->onDelete('cascade');
    $table->timestamps();
    $table->softDeletes();

    // Composite index for efficient queries
    $table->index(['daily_tracker_uuid', 'supplement_type']);
    $table->index(['daily_tracker_uuid', 'taken_at']);
});
```

## Activities

```php
Schema::create('activities', function (Blueprint $table) {
    $table->uuid('uuid')->primary();
    $table->string('name')->notNull();
    $table->string('description')->nullable();
    $table->dateTime('schedule_start_date_time')->nullable();
    $table->dateTime('schedule_end_date_time')->nullable();
    $table->string('location')->nullable();
    $table->string('location_remark')->nullable();
    $table->unsignedSmallInteger('invites')->nullable();
    $table->unsignedSmallInteger('accepted')->nullable();
    $table->enum('type', ['Group', 'Individual'])->default('Individual');
    $table->enum('activity_type', ['TTP', 'Flyer', 'Survey', 'Health Check Camp', 'Road Show', 'Afresh Party', 'MIW', 'Business Opportunity', 'Social Media Ads', 'Bulk Messaging', 'Bulk Emailing', 'Poster'])->default('TTP');
    $table->enum('activity_type_remark', ['major', 'minor', 'other'])->default('major');
    $table->string('activity_type_remark_other')->nullable();
    $table->enum('activity_status', ['Scheduled', 'Completed', 'Cancelled', 'Pending'])->default('Pending');
    $table->string('activity_status_remark')->nullable();
    $table->enum('prospect_distribution_method', ['only_COI_provider', 'equally_distributed', 'individual', 'other'])->default('only_COI_provider');
    $table->string('other_distribution_method')->nullable();
    $table->json('prospects')->nullable();
    $table->foreignUuid('created_by')->nullable()->constrained('users', 'uuid')->onDelete('cascade')->index();
    $table->foreignUuid('updated_by')->nullable()->constrained('users', 'uuid')->onDelete('cascade');
    $table->foreignUuid('deleted_by')->nullable()->constrained('users', 'uuid')->onDelete('cascade');
    $table->timestamps();
    $table->softDeletes();
});
```

```php
Schema::create('activity_participants', function (Blueprint $table) {
    $table->uuid('uuid')->primary();
    $table->foreignUuid('activity_uuid')->constrained('activities', 'uuid')->onDelete('cascade')->index();
    $table->foreignUuid('user_uuid')->constrained('users', 'uuid')->onDelete('cascade')->index();
    $table->enum('status', ['Invited', 'Accepted', 'Rejected', 'Cancelled'])->default('Invited');
    $table->string('status_remark')->nullable();
    $table->enum('role', ['Creator', 'Participant', 'Scanning', 'Counseling', 'Invitee', 'Other', 'Learner'])->default('Participant');
    $table->string('role_remark')->nullable();
    $table->string('notes')->nullable();
    $table->timestamps();
    $table->softDeletes();
});
```

```php
Schema::table('prospects', function (Blueprint $table) {
    $table->foreignUuid('activity_uuid')->nullable()->constrained('activities', 'uuid')->onDelete('cascade')->index();
});
```
- Prospects Array (with assignment)


```php
// add  consent,  theme, timezone, language to user profile
Schema::table('users', function (Blueprint $table) {
    $table->boolean('consent')->default(false);
    $table->string('theme')->default('system');
    $table->string('timezone')->default('Asia/Kolkata');
    $table->string('language')->default('en');
});
```


If Activity type is Group, and Participant coaches are not under creator, then he has to share link to other coaches to participate.  And creater has to approve it.
If coaches under creator, then he can send invites directly, coaches has to accept.

Missing Points to Add
1. Add user uuid to fixed table also to add their own content

## Stock Management System

### Core Concepts
The stock management system handles:
1. **Stock Receipt**: Stock received from company via invoices (99% of cases)
2. **Stock Consumption**: Personal consumption, sales to guests/customers, club usage, losses, etc.
3. **Batch Tracking**: Different price batches for same product (e.g., last year's stock vs current year)
4. **Profit Calculation**: Based on actual purchase price vs selling price using FIFO/LIFO methods

### Database Schema

```php
// Products table (unchanged - master product catalog)
Schema::create('products', function (Blueprint $table) {
    $table->uuid('uuid')->primary();
    $table->string('sku')->unique();
    $table->string('name')->index();
    $table->decimal('volume_points', 8, 2);
    $table->decimal('earn_base', 8, 2);
    $table->decimal('base_price', 10, 2);
    $table->decimal('tax_percentage', 5, 2);
    $table->decimal('mrp', 10, 2);
    $table->decimal('discount_15_price', 10, 2);
    $table->decimal('discount_25_price', 10, 2);
    $table->decimal('discount_35_price', 10, 2);
    $table->decimal('discount_42_price', 10, 2);
    $table->decimal('discount_50_price', 10, 2);
    $table->string('unit', 50);
    $table->decimal('vp_per_unit', 8, 2);
    $table->date('price_release_date');
    $table->boolean('is_active')->default(true);
    $table->foreignUuid('created_by')->nullable()->constrained('users', 'uuid')->onDelete('cascade');
    $table->foreignUuid('updated_by')->nullable()->constrained('users', 'uuid')->onDelete('cascade');
    $table->foreignUuid('deleted_by')->nullable()->constrained('users', 'uuid')->onDelete('cascade');
    $table->timestamps();
    $table->softDeletes();
});

// Product price history (unchanged)
Schema::create('product_histories', function (Blueprint $table) {
    $table->uuid('uuid')->primary();
    $table->foreignUuid('product_id')->constrained('products', 'uuid')->onDelete('cascade');
    $table->string('sku');
    $table->string('name');
    $table->decimal('volume_points', 8, 2);
    $table->decimal('earn_base', 8, 2);
    $table->decimal('base_price', 10, 2);
    $table->decimal('tax_percentage', 5, 2);
    $table->decimal('mrp', 10, 2);
    $table->decimal('discount_15_price', 10, 2);
    $table->decimal('discount_25_price', 10, 2);
    $table->decimal('discount_35_price', 10, 2);
    $table->decimal('discount_42_price', 10, 2);
    $table->decimal('discount_50_price', 10, 2);
    $table->string('unit', 50);
    $table->decimal('vp_per_unit', 8, 2);
    $table->date('price_release_date');
    $table->boolean('is_active')->default(true);
    $table->foreignUuid('created_by')->nullable()->constrained('users', 'uuid')->onDelete('cascade');
    $table->foreignUuid('updated_by')->nullable()->constrained('users', 'uuid')->onDelete('cascade');
    $table->foreignUuid('deleted_by')->nullable()->constrained('users', 'uuid')->onDelete('cascade');
    $table->timestamps();
    $table->softDeletes();
});

// Stock locations (unchanged)
Schema::create('stock_locations', function (Blueprint $table) {
    $table->uuid('uuid')->primary();
    $table->string('name');
    $table->enum('type', ['club', 'club_physical', 'club_virtual', 'coach', 'member', 'warehouse', 'Other']);
    $table->foreignUuid('owner_uuid')->constrained('users', 'uuid')->onDelete('cascade')->index();
    $table->text('address')->nullable();
    $table->boolean('is_active')->default(true);
    $table->foreignUuid('created_by')->nullable()->constrained('users', 'uuid')->onDelete('cascade');
    $table->foreignUuid('updated_by')->nullable()->constrained('users', 'uuid')->onDelete('cascade');
    $table->foreignUuid('deleted_by')->nullable()->constrained('users', 'uuid')->onDelete('cascade');
    $table->timestamps();
    $table->softDeletes();
});

// NEW: Company invoices (for stock receipt tracking)
Schema::create('company_invoices', function (Blueprint $table) {
    $table->uuid('uuid')->primary();
    $table->string('invoice_number')->unique();
    $table->date('invoice_date');
    $table->date('received_date');
    $table->decimal('total_amount', 12, 2);
    $table->decimal('total_tax', 10, 2)->default(0);
    $table->decimal('total_volume_points', 10, 2)->default(0);
    $table->enum('status', ['pending', 'received', 'verified', 'cancelled'])->default('pending');
    $table->text('notes')->nullable();
    $table->foreignUuid('received_by')->constrained('users', 'uuid')->onDelete('cascade');
    $table->foreignUuid('verified_by')->nullable()->constrained('users', 'uuid')->onDelete('cascade');
    $table->timestamp('verified_at')->nullable();
    $table->foreignUuid('created_by')->nullable()->constrained('users', 'uuid')->onDelete('cascade');
    $table->foreignUuid('updated_by')->nullable()->constrained('users', 'uuid')->onDelete('cascade');
    $table->foreignUuid('deleted_by')->nullable()->constrained('users', 'uuid')->onDelete('cascade');
    $table->timestamps();
    $table->softDeletes();
    
    // Performance indexes
    $table->index(['invoice_date']);
    $table->index(['received_date']);
    $table->index(['status']);
    $table->index(['received_by']);
});

// NEW: Invoice items (individual products in invoice)
Schema::create('invoice_items', function (Blueprint $table) {
    $table->uuid('uuid')->primary();
    $table->foreignUuid('invoice_uuid')->constrained('company_invoices', 'uuid')->onDelete('cascade');
    $table->foreignUuid('product_uuid')->constrained('products', 'uuid')->onDelete('cascade');
    $table->decimal('quantity', 10, 2);
    $table->decimal('unit_price', 10, 2);
    $table->decimal('total_price', 12, 2);
    $table->decimal('tax_amount', 10, 2)->default(0);
    $table->decimal('volume_points', 8, 2)->default(0);
    $table->string('batch_number')->nullable(); // Company batch number
    $table->date('expiry_date')->nullable();
    $table->text('notes')->nullable();
    $table->foreignUuid('created_by')->nullable()->constrained('users', 'uuid')->onDelete('cascade');
    $table->foreignUuid('updated_by')->nullable()->constrained('users', 'uuid')->onDelete('cascade');
    $table->foreignUuid('deleted_by')->nullable()->constrained('users', 'uuid')->onDelete('cascade');
    $table->timestamps();
    $table->softDeletes();
    
    // Performance indexes
    $table->index(['invoice_uuid']);
    $table->index(['product_uuid']);
    $table->index(['batch_number']);
    $table->index(['expiry_date']);
});

// REVISED: Stocks (main stock table for each SKU at each location)
Schema::create('stocks', function (Blueprint $table) {
    $table->uuid('uuid')->primary();
    $table->foreignUuid('product_uuid')->constrained('products', 'uuid')->onDelete('cascade');
    $table->foreignUuid('location_uuid')->constrained('stock_locations', 'uuid')->onDelete('cascade');
    $table->decimal('total_quantity', 10, 2)->default(0); // Total stock available
    $table->decimal('reserved_quantity', 10, 2)->default(0); // Reserved for **orders**
    $table->decimal('average_cost', 10, 2)->default(0); // Weighted average cost
    $table->decimal('total_value', 12, 2)->default(0); // Total stock value
    $table->date('last_updated')->nullable();
    $table->text('notes')->nullable();
    $table->foreignUuid('created_by')->nullable()->constrained('users', 'uuid')->onDelete('cascade');
    $table->foreignUuid('updated_by')->nullable()->constrained('users', 'uuid')->onDelete('cascade');
    $table->foreignUuid('deleted_by')->nullable()->constrained('users', 'uuid')->onDelete('cascade');
    $table->timestamps();
    $table->softDeletes();
    
    // Performance indexes
    $table->unique(['product_uuid', 'location_uuid']); // One stock record per product per location
    $table->index(['product_uuid']);
    $table->index(['location_uuid']);
    $table->index(['available_quantity']);
    $table->index(['last_updated']);
});

// NEW: Stock items (detailed tracking of individual stock receipts)
Schema::create('stock_items', function (Blueprint $table) {
    $table->uuid('uuid')->primary();
    $table->foreignUuid('stock_uuid')->constrained('stocks', 'uuid')->onDelete('cascade');
    $table->foreignUuid('invoice_item_uuid')->constrained('invoice_items', 'uuid')->onDelete('cascade');
    $table->string('batch_number')->nullable(); // Company batch number
    $table->decimal('purchase_price', 10, 2); // Actual purchase price from invoice
    $table->decimal('initial_quantity', 10, 2); // Initial quantity received
    $table->decimal('remaining_quantity', 10, 2); // Current remaining quantity
    $table->date('purchase_date'); // Date from invoice
    $table->date('expiry_date')->nullable();
    $table->enum('status', ['active', 'expired', 'depleted'])->default('active');
    $table->text('notes')->nullable();
    $table->foreignUuid('created_by')->nullable()->constrained('users', 'uuid')->onDelete('cascade');
    $table->foreignUuid('updated_by')->nullable()->constrained('users', 'uuid')->onDelete('cascade');
    $table->foreignUuid('deleted_by')->nullable()->constrained('users', 'uuid')->onDelete('cascade');
    $table->timestamps();
    $table->softDeletes();
    
    // Performance indexes
    $table->index(['stock_uuid']);
    $table->index(['batch_number']);
    $table->index(['purchase_date']);
    $table->index(['expiry_date']);
    $table->index(['status']);
    $table->index(['remaining_quantity']);
});

// REVISED: Stock movements (detailed tracking of all stock movements)
Schema::create('stock_movements', function (Blueprint $table) {
    $table->uuid('uuid')->primary();
    $table->enum('movement_type', [
        'receipt',           // Stock received from company
        'transfer',          // Transfer between locations
        'sale_guest',        // Sale to new guest
        'sale_customer',     // Sale to existing customer
        'personal_consumption', // Personal use
        'club_consumption',  // Club usage
        'loss',              // Lost/damaged
        'expired',           // Expired stock
        'adjustment',        // Manual adjustment
        'reservation',       // Reserve for order
        'unreservation'      // Cancel reservation
    ]);
    $table->foreignUuid('stock_uuid')->constrained('stocks', 'uuid')->onDelete('cascade');
    $table->foreignUuid('stock_item_uuid')->nullable()->constrained('stock_items', 'uuid')->onDelete('cascade'); // For FIFO tracking
    $table->foreignUuid('from_location_uuid')->nullable()->constrained('stock_locations', 'uuid')->onDelete('cascade');
    $table->foreignUuid('to_location_uuid')->nullable()->constrained('stock_locations', 'uuid')->onDelete('cascade');
    $table->decimal('quantity', 10, 2);
    $table->decimal('unit_price', 10, 2); // Price at time of movement
    $table->decimal('total_amount', 12, 2);
    $table->decimal('profit_loss', 12, 2)->nullable(); // For sales: selling_price - purchase_price
    
    // Reference tracking
    $table->string('reference_type', 100)->nullable(); // 'order', 'club_consumption', 'shake_counter', 'invoice'
    $table->string('reference_uuid', 36)->nullable();
    
    // Customer/User tracking for sales
    $table->foreignUuid('customer_uuid')->nullable()->constrained('users', 'uuid')->onDelete('cascade');
    $table->foreignUuid('club_uuid')->nullable()->constrained('clubs', 'uuid')->onDelete('cascade');
    
    // Approval workflow
    $table->foreignUuid('performed_by')->constrained('users', 'uuid')->onDelete('cascade');
    $table->foreignUuid('approved_by')->nullable()->constrained('users', 'uuid')->onDelete('cascade');
    $table->timestamp('approved_at')->nullable();
    $table->enum('status', ['pending', 'approved', 'rejected', 'cancelled'])->default('pending');
    
    $table->text('notes')->nullable();
    $table->foreignUuid('created_by')->nullable()->constrained('users', 'uuid')->onDelete('cascade');
    $table->foreignUuid('updated_by')->nullable()->constrained('users', 'uuid')->onDelete('cascade');
    $table->foreignUuid('deleted_by')->nullable()->constrained('users', 'uuid')->onDelete('cascade');
    $table->timestamps();
    $table->softDeletes();
    
    // Performance indexes
    $table->index(['movement_type']);
    $table->index(['stock_uuid']);
    $table->index(['stock_item_uuid']);
    $table->index(['from_location_uuid']);
    $table->index(['to_location_uuid']);
    $table->index(['customer_uuid']);
    $table->index(['club_uuid']);
    $table->index(['performed_by']);
    $table->index(['status']);
    $table->index(['reference_type', 'reference_uuid']);
});

// NEW: Stock reservations (for pending orders)
Schema::create('stock_reservations', function (Blueprint $table) {
    $table->uuid('uuid')->primary();
    $table->foreignUuid('stock_uuid')->constrained('stocks', 'uuid')->onDelete('cascade');
    $table->foreignUuid('customer_uuid')->nullable()->constrained('users', 'uuid')->onDelete('cascade');
    $table->decimal('quantity', 10, 2);
    $table->date('reserved_until');
    $table->enum('status', ['active', 'fulfilled', 'expired', 'cancelled'])->default('active');
    $table->text('notes')->nullable();
    $table->foreignUuid('created_by')->nullable()->constrained('users', 'uuid')->onDelete('cascade');
    $table->foreignUuid('updated_by')->nullable()->constrained('users', 'uuid')->onDelete('cascade');
    $table->foreignUuid('deleted_by')->nullable()->constrained('users', 'uuid')->onDelete('cascade');
    $table->timestamps();
    $table->softDeletes();
    
    // Performance indexes
    $table->index(['stock_uuid']);
    $table->index(['customer_uuid']);
    $table->index(['reserved_until']);
    $table->index(['status']);
});

// NEW: Stock valuation (for profit/loss tracking)
Schema::create('stock_valuations', function (Blueprint $table) {
    $table->uuid('uuid')->primary();
    $table->foreignUuid('location_uuid')->constrained('stock_locations', 'uuid')->onDelete('cascade');
    $table->foreignUuid('product_uuid')->constrained('products', 'uuid')->onDelete('cascade');
    $table->decimal('total_quantity', 10, 2);
    $table->decimal('average_cost', 10, 2); // Weighted average cost
    $table->decimal('total_value', 12, 2);
    $table->decimal('market_value', 12, 2); // Current market value
    $table->decimal('unrealized_profit_loss', 12, 2); // Market value - Total value
    $table->date('valuation_date');
    $table->text('notes')->nullable();
    $table->foreignUuid('created_by')->nullable()->constrained('users', 'uuid')->onDelete('cascade');
    $table->foreignUuid('updated_by')->nullable()->constrained('users', 'uuid')->onDelete('cascade');
    $table->foreignUuid('deleted_by')->nullable()->constrained('users', 'uuid')->onDelete('cascade');
    $table->timestamps();
    $table->softDeletes();
    
    // Performance indexes
    $table->index(['location_uuid']);
    $table->index(['product_uuid']);
    $table->index(['valuation_date']);
    $table->unique(['location_uuid', 'product_uuid', 'valuation_date']);
});
```

### Key Features

1. **Invoice-Based Stock Receipt**
   - Track complete invoices from company
   - Multiple products per invoice
   - Batch/lot tracking with expiry dates

2. **Stock-Level Inventory Management**
   - Main stock table tracks total quantity and average cost
   - Stock items track individual receipts with purchase prices
   - FIFO consumption from stock items for accurate profit calculation
   - Expiry date tracking at stock item level

3. **Detailed Movement Tracking**
   - All stock movements are tracked with source and destination
   - Profit/loss calculation for sales
   - Reference tracking for orders, club usage, etc.

4. **Reservation System**
   - Reserve stock for pending orders
   - Prevent overselling
   - Automatic expiration of reservations

5. **Valuation and Reporting**
   - Real-time stock valuation
   - Profit/loss tracking
   - Market value vs cost value

### Business Logic

1. **Stock Receipt Process**
   - Create company invoice
   - Add invoice items with quantities and prices
   - System creates stock batches automatically
   - Update location stock levels

2. **Stock Consumption (FIFO Method)**
   - System consumes oldest stock items first
   - Calculate profit based on actual purchase price from stock items
   - Update stock quantities and stock item quantities
   - Track movement history with stock item reference

3. **Profit Calculation**
   - Selling Price - Purchase Price = Profit/Loss
   - Track profit by batch
   - Aggregate profit reports

4. **Stock Transfers**
   - Move stock between locations
   - Maintain stock item integrity for FIFO tracking
   - Update location stock levels

### API Endpoints

```php
// Company Invoice Management
GET /api/company-invoices
POST /api/company-invoices
GET /api/company-invoices/{invoice}
PUT /api/company-invoices/{invoice}
DELETE /api/company-invoices/{invoice}
POST /api/company-invoices/{invoice}/verify

// Invoice Items Management
GET /api/invoice-items
POST /api/invoice-items
GET /api/invoice-items/{item}
PUT /api/invoice-items/{item}
DELETE /api/invoice-items/{item}
GET /api/invoice-items/by-invoice/{invoiceUuid}

// Stock Batch Management
GET /api/stock-batches
POST /api/stock-batches
GET /api/stock-batches/{batch}
PUT /api/stock-batches/{batch}
DELETE /api/stock-batches/{batch}
GET /api/stock-batches/by-location/{locationUuid}
GET /api/stock-batches/by-product/{productUuid}
GET /api/stock-batches/expiring-soon

// Stock Movement Management
GET /api/stock-movements
POST /api/stock-movements
GET /api/stock-movements/{movement}
PUT /api/stock-movements/{movement}
DELETE /api/stock-movements/{movement}
GET /api/stock-movements/by-location/{locationUuid}
GET /api/stock-movements/by-type/{type}
POST /api/stock-movements/{movement}/approve

// Stock Reservation Management
GET /api/stock-reservations
POST /api/stock-reservations
GET /api/stock-reservations/{reservation}
PUT /api/stock-reservations/{reservation}
DELETE /api/stock-reservations/{reservation}
GET /api/stock-reservations/by-customer/{customerUuid}
POST /api/stock-reservations/{reservation}/fulfill

// Stock Valuation Management
GET /api/stock-valuations
POST /api/stock-valuations
GET /api/stock-valuations/{valuation}
PUT /api/stock-valuations/{valuation}
DELETE /api/stock-valuations/{valuation}
GET /api/stock-valuations/by-location/{locationUuid}
GET /api/stock-valuations/profit-loss-report
```


## Club Management System

```php
Schema::create('clubs', function (Blueprint $table) {
    $table->uuid('uuid')->primary();
    $table->string('name');
    $table->string('tagline', 500)->nullable();
    $table->enum('club_type', ['UMS', 'Centralise', '2_Time_UMS', '2_Time_Centralise']);
    $table->enum('club_mode', ['Offline', 'Online', 'Hybrid', '2_Time_Offline', 'Hybrid_with_2_Time_Online']);
    $table->date('start_date');
    $table->boolean('is_active')->default(true);
    $table->foreignUuid('owner_id')->constrained('users', 'uuid')->onDelete('cascade');
    $table->foreignUuid('created_by')->nullable()->constrained('users', 'uuid')->onDelete('cascade');
    $table->foreignUuid('updated_by')->nullable()->constrained('users', 'uuid')->onDelete('cascade');
    $table->foreignUuid('deleted_by')->nullable()->constrained('users', 'uuid')->onDelete('cascade');
    $table->timestamps();
    $table->softDeletes();
    
    // Performance indexes
    $table->index(['owner_id']);
    $table->index(['is_active']);
});

Schema::create('club_memberships', function (Blueprint $table) {
    $table->uuid('uuid')->primary();
    $table->foreignUuid('club_uuid')->constrained('clubs', 'uuid')->onDelete('cascade');
    $table->foreignUuid('user_uuid')->constrained('users', 'uuid')->onDelete('cascade');
    $table->enum('association_type', ['Membership', 'Kit_Plus_Fee', 'Owner', 'Guest', 'Only_excercise', 'excercise_afresh']);
    $table->decimal('membership_fee', 10, 2)->nullable();
    $table->timestamp('joined_at')->useCurrent();
    $table->timestamp('expires_at')->nullable();
    $table->boolean('is_active')->default(true);
    $table->foreignUuid('created_by')->nullable()->constrained('users', 'uuid')->onDelete('cascade');
    $table->foreignUuid('updated_by')->nullable()->constrained('users', 'uuid')->onDelete('cascade');
    $table->foreignUuid('deleted_by')->nullable()->constrained('users', 'uuid')->onDelete('cascade');
    $table->timestamps();
    $table->softDeletes();
    
    // Performance indexes
    $table->index(['club_uuid']);
    $table->index(['user_uuid']);
    $table->index(['expires_at']);
});
```

#### Shake Counter Implementation:
```php
Schema::create('shake_combinations', function (Blueprint $table) {
    $table->uuid('uuid')->primary();
    $table->string('name');
    $table->unsignedInteger('serving_size')->default(1);
    $table->foreignUuid('flavor_1_product_id')->nullable()->constrained('products', 'uuid')->onDelete('cascade');
    $table->decimal('flavor_1_quantity', 5, 2)->nullable();
    $table->foreignUuid('flavor_2_product_id')->nullable()->constrained('products', 'uuid')->onDelete('cascade');
    $table->decimal('flavor_2_quantity', 5, 2)->nullable();
    $table->foreignUuid('flavor_3_product_id')->nullable()->constrained('products', 'uuid')->onDelete('cascade');
    $table->decimal('flavor_3_quantity', 5, 2)->nullable();
    $table->decimal('shakemate_quantity', 5, 2)->nullable();
    $table->decimal('protein_quantity', 5, 2)->nullable();
    $table->decimal('water_quantity', 5, 2)->nullable();
    $table->decimal('ice_quantity', 5, 2)->nullable();
    $table->text('notes')->nullable();
    $table->foreignUuid('created_by')->constrained('users', 'uuid')->onDelete('cascade');
    $table->foreignUuid('updated_by')->nullable()->constrained('users', 'uuid')->onDelete('cascade');
    $table->foreignUuid('deleted_by')->nullable()->constrained('users', 'uuid')->onDelete('cascade');
    $table->timestamps();
    $table->softDeletes();
    
    // Performance indexes
    $table->index(['created_by']);
});

Schema::create('club_shake_counter', function (Blueprint $table) {
    $table->uuid('uuid')->primary();
    $table->foreignUuid('club_id')->constrained('clubs', 'uuid')->onDelete('cascade');
    $table->foreignUuid('member_id')->constrained('users', 'uuid')->onDelete('cascade');
    $table->foreignUuid('shake_combination_id')->constrained('shake_combinations', 'uuid')->onDelete('cascade');
    $table->timestamp('first_serving_at')->nullable();
    $table->timestamp('refill_serving_at')->nullable();
    $table->foreignUuid('counter_operator_id')->constrained('users', 'uuid')->onDelete('cascade');
    $table->date('date');
    $table->foreignUuid('created_by')->nullable()->constrained('users', 'uuid')->onDelete('cascade');
    $table->foreignUuid('updated_by')->nullable()->constrained('users', 'uuid')->onDelete('cascade');
    $table->foreignUuid('deleted_by')->nullable()->constrained('users', 'uuid')->onDelete('cascade');
    $table->timestamps();
    $table->softDeletes();
    
    // Performance indexes
    $table->index(['club_id']);
    $table->index(['member_id']);
    $table->index(['date']);
    $table->index(['counter_operator_id']);
});
```





## Implementation Status

### âœ… Completed Features

**Backend Infrastructure:**
- Laravel 12 with PHP 8.4 setup
- Laravel Sanctum authentication
- Spatie Laravel Permission for RBAC
- Laravel Auditing for audit trails
- Laravel Telescope for debugging
- Laravel Horizon for queue management
- Laravel Pulse for application monitoring
- Laravel Backup for data backup
- Development tools: Laravel Pint, Larastan, PHPUnit, Laravel IDE Helper

**Database Migrations:**
- Users table with UUID primary keys
- Prospects table with all required fields
- Profile Details table with marketing level hierarchy
- Health Data table for user/prospect health information
- Measurements table for tracking body metrics
- Daily Trackers table for wellness tracking
- Groups table for user categorization
- Marketing Levels table for business hierarchy
- Contacts table for multiple contact methods
- Addresses table for location management
- Photos table for media storage

**API Endpoints:**
- Authentication: register, login, logout, forgot-password, forgot-username, reset-password, email verification
- Prospect management: full CRUD with conversion functionality
- Profile details management: full CRUD with prospect conversion
- Health data management: full CRUD operations
- Measurement management: full CRUD operations
- Daily tracker management: full CRUD with validation

**Models & Relationships:**
- User model with UUID support and auditing
- Prospect model with polymorphic relationships
- ProfileDetail model with marketing level hierarchy
- HealthData model with polymorphic relationships
- Measurement model with polymorphic relationships
- DailyTracker model with validation support
- All models include proper relationships and soft deletes

**New Models Required:**
- Product model with UUID support and auditing
- CompanyInvoice model with UUID support and auditing
- InvoiceItem model with UUID support and auditing
- StockLocation model with UUID support and auditing
- Stock model with UUID support and auditing
- StockItem model with UUID support and auditing
- StockMovement model with UUID support and auditing
- StockReservation model with UUID support and auditing
- StockValuation model with UUID support and auditing
- Club model with UUID support and auditing
- ClubMembership model with UUID support and auditing
- ShakeCombination model with UUID support and auditing
- ClubShakeCounter model with UUID support and auditing

**Role-Based Access Control:**
- Super Admin: Full system access
- Mentor: Create/update/delete all records
- Coach: Create own, update own/all, delete own
- Member: Create/update/delete own records
- Guest: Read-only access (ABAC controlled)

**Frontend Development:**
- Quasar framework setup
- Vue.js 4 components
- Pinia store management
- User interface for all CRUD operations
- Profile switching functionality
- Dark mode support

### ðŸš§ In Progress / Planned Features

**Additional Backend Features:**
- Club management system (âœ… Schema defined)
- Stock and inventory management (âœ… Schema defined)
- Financial tracking and reporting
- Assessment and survey tools
- Product/Service/Program/Batch management (âœ… Schema defined)
- Communication and notification systems
- Advanced ABAC implementation with tags

**Security Enhancements:**
- Password policy enforcement
- Token expiration management
- Rate limiting implementation
- Advanced audit trail features

**Integration Features:**
- Photo compression and storage optimization
- Address validation services
- Google Maps integration
- Email/SMS notification systems
