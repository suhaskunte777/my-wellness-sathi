# Wellness and Lead Management Application 

## Table of Contents
- [Wellness and Lead Management Application](#wellness-and-lead-management-application)
  - [Table of Contents](#table-of-contents)
  - [System Overview](#system-overview)
    - [Application Purpose](#application-purpose)
    - [Core Functionalities](#core-functionalities)
  - [Technology Stack](#technology-stack)
    - [Backend Framework](#backend-framework)
    - [Backend Development Tools](#backend-development-tools)
    - [Frontend Framework \& Packages](#frontend-framework--packages)
  - [User Authentication](#user-authentication)
  - [User Roles \& Permissions](#user-roles--permissions)
    - [Package for User and Access Management](#package-for-user-and-access-management)
    - [Primary Roles](#primary-roles)
    - [Access Control \& Permission Structure (RBAC + ABAC)](#access-control--permission-structure-rbac--abac)
  - [User and Related Migrations](#user-and-related-migrations)
    - [Core User Migration](#core-user-migration)
    - [Required Spatie Permission Migrations](#required-spatie-permission-migrations)
    - [Required Spatie Tags Migrations](#required-spatie-tags-migrations)
    - [Laravel Sanctum Migration](#laravel-sanctum-migration)
    - [Password Reset Migration](#password-reset-migration)
    - [Laravel Auditing Migration](#laravel-auditing-migration)
  - [Permission Definitions](#permission-definitions)
    - [Core Permissions](#core-permissions)
    - [Role-Permission Mappings](#role-permission-mappings)
  - [Security Considerations](#security-considerations)
    - [Password Policy](#password-policy)
    - [Token Management](#token-management)
    - [Rate Limiting](#rate-limiting)
    - [Audit Trail](#audit-trail)
  - [API Authentication Endpoints](#api-authentication-endpoints)
  - [Prospect and Related Migrations](#prospect-and-related-migrations)
  - [User and Prospect Shared Migritions](#user-and-prospect-shared-migritions)
    - [Profile Details](#profile-details)
    - [Address](#address)
    - [Contacts](#contacts)
    - [Health](#health)

## System Overview

### Application Purpose
A comprehensive wellness industry platform serving four primary user types:
- **Coaches**: Wellness professionals who help others achieve health goals
- **Members**: Individuals progressing toward health goals
- **Mentors**: Primarily Coaches but also successful business leaders providing guidance
- **Guest**: Individuals who are prospect members of the organization, they are not registered yet so can't access any content. Those added by admin or coach will be called as Guest. Can be converted to member by admin or coach, once they take our product/program/service.

### Core Functionalities
- User Authentication and Authorization
- Prospect management and tracking 
- Member measurement and tracking
- Club Management and attendance
- Stock and inventory management
- Financial tracking and reporting
- Assessment, survey, TTP and Camp tools 
- Product/Service/Program/Batch management
- Marketing level management
- Communication and notification systems

## Technology Stack

- Backend is API only for application
- Also backend will have some UI for Horizon and Pulse
- Frontend will be Separate repository based on Quasar
- we will use uuid wherever data is getting generated by user, to facilitate offline creation of records.
- Models which only can create in online mode or not created by user can still continue using bigint id.
- SoftDelete all the tables, if excepting any table mention specifically why softDelete is not required their.
- Application should support dark mode (using Quasar)
- Use Quasar css classes for styling

### Backend Framework
- **Laravel 12** with PHP 8.4
- **MySQL 8.0+** for primary database
- **Redis** for caching and session management
- **Laravel Sanctum** for API authentication
- **Laravel Auditing** for audit trails
- **Spatie Laravel Permission** for RBAC
- **Spatie Laravel Tags** for tags ABAC
- **Laravel Backup** for data backup
- **Laravel Telescope** for debugging
- **Laravel Horizon** for queue management

### Backend Development Tools
- **Laravel Pail** for file storage
- **Laravel Pint** for code formatting
- **Larastan** for static analysis
- **PHPUnit** for testing

### Frontend Framework & Packages
- **Vue.js 4** 
- **Node.js 22**
- **PNPM** for package management
- **Quasar framework 2.18**
- **Vue router**
- **Pinia** Store Management
- **Axios** 
- **vcards-js**
- **dayjs**
- **html2pdf.js**
- **uuid** - for uuid generation

## User Authentication

- Use Token based authentication provided by *laravel/sanctum*
- User may have same email and mobile for multiple accounts
- We will use username (Unique across users) and password for authentication
- User belongs to family for viewing / switching other profiles
- Frontend should have quick profile switching support for authenticated user as Google provides for Gmail, Maps etc.
- For forget password, use username along with birth date and email.
- For forget username, use birth date, email, herbalife ID
- User only be created by invitation only

## User Roles & Permissions

### Package for User and Access Management
- Use *laravel/sanctum* for token based authentication (not cookie based)
- Use *spatie/laravel-permission* package for Role and Permission Management
- Use *spatie/laravel-tags* package for Tag Management

### Primary Roles
1. **Super Admin** - Full system access (Only one seeded by seeders)
2. **Admin** - Organization-level management (User is admin for his Organization. User will get manage organization feature after Active World Team. User org is members joined by him and his downline members)
3. **Mentor** - Business leadership and guidance (User is above GET marketing level is called as mentor)
4. **Coach** - Wellness coaching and member management (User in helping others to achieve their health goals is called as coach until they achieve GET marketing level)
5. **Member** - Personal wellness journey tracking (User is tracking their own wellness journey)
6. **Guest** - Limited access for assessments (User is not a member of the organization)

### Access Control & Permission Structure (RBAC + ABAC)

- Role Based Access Control
  - Used for Create, Update and Delete permission

- Attribute Based Access Control
  - Used for view can view given Model (data)
  - Tags will be used as attribute to control this behavior
  - User Groups will be assigned tags

## User and Related Migrations

### Core User Migration
```php
    Schema::create('users', function (Blueprint $table) {
        $table->uuid('uuid')->primary();
        $table->string('name');
        $table->date('birth_date')->nullable();
        $table->string('business_id')->nullable();
        $table->boolean('business_owner')->default(0);
        $table->string('username')->unique();
        $table->string('email')->index();
        $table->timestamp('email_verified_at')->nullable();
        $table->string('mobile');
        $table->timestamp('mobile_verified_at')->nullable();
        $table->string('password');
        $table->foreign('created_by')->references('id')->on('users');
        $table->rememberToken();
        $table->timestamps();
        $table->softDeletes();
    });
```

### Required Spatie Permission Migrations
 - We will use default tables from spatie/laravel-permission

### Required Spatie Tags Migrations
- Use spatie/laravel-tags default tags tables

### Laravel Sanctum Migration
```php
Schema::create('personal_access_tokens', function (Blueprint $table) {
    $table->id();
    $table->morphs('tokenable');
    $table->string('name');
    $table->string('type');
    $table->string('hash', 64)->unique();
    $table->text('abilities')->nullable();
    $table->timestamp('last_used_at')->nullable();
    $table->timestamp('expires_at')->nullable();
    $table->timestamps();
});
```

### Password Reset Migration
```php
Schema::create('password_reset_tokens', function (Blueprint $table) {
    $table->string('username')->primary();
    $table->string('token');
    $table->timestamp('created_at')->nullable();
});
```

### Laravel Auditing Migration
- We will use default migration from auditing package.

## Permission Definitions

### Core Permissions
```php
// User Management
'user.view', 'user.create', 'user.update', 'user.delete', 'user.invite'

// Role Management  
'role.view', 'role.create', 'role.update', 'role.delete', 'role.assign'

// Permission Management
'permission.view', 'permission.create', 'permission.update', 'permission.delete'

// Content Management
'content.view', 'content.create', 'content.update', 'content.delete'

// Assessment Management
'assessment.view', 'assessment.create', 'assessment.update', 'assessment.delete'

// Club Management
'club.view', 'club.create', 'club.update', 'club.delete', 'club.attend'

// Stock Management
'stock.view', 'stock.create', 'stock.update', 'stock.delete'

// Financial Management
'financial.view', 'financial.create', 'financial.update', 'financial.delete'

// Communication Management
'communication.view', 'communication.create', 'communication.update', 'communication.delete'
```

### Role-Permission Mappings
```php
// Super Admin - All permissions
'Super Admin' => ['*']

// Admin - Organization management
'Admin' => [
    'user.view', 'user.create', 'user.update', 'user.invite',
]

// Mentor - Business guidance
'Mentor' => [
    'user.view', 'user.invite',
]

// Coach - Member management
'Coach' => [
    'user.view', 'user.invite',
]

// Member - Personal tracking
'Member' => [
    'content.view',
]

// Guest - Limited access
'Guest' => [
    // 'assessment.view'
]
```

## Security Considerations

### Password Policy
- Minimum 8 characters
- Must contain uppercase, lowercase, number, and special character
- Password history: 3 previous passwords
- Password expiration: 90 days

### Token Management
- Access token expiration: 24 hours
- Refresh token expiration: 30 days
- Maximum active tokens per user: 3

### Rate Limiting
- Login attempts: 5 per 15 minutes
- API requests: 1000 per hour per user
- Password reset: 3 per hour per email

### Audit Trail
- All user actions logged
- Sensitive operations require additional verification
- Failed authentication attempts logged
- Token usage tracked

## API Authentication Endpoints

```php
// Authentication Routes
POST /api/auth/login
POST /api/auth/register (invitation only)
POST /api/auth/logout
POST /api/auth/refresh
POST /api/auth/forgot-password
POST /api/auth/forgot-username
POST /api/auth/reset-password
POST /api/auth/verify-email
POST /api/auth/verify-mobile

// Profile Management
GET /api/auth/profile
PUT /api/auth/profile
PUT /api/auth/password
POST /api/auth/profile-switch (for all authenticated profiles)
```


## Prospect and Related Migrations

```sql
Schema::create('prospects', function (Blueprint $table) {
        $table->uuid('uuid')->primary();
        $table->string('name');
        $table->string('primary_phone')->nullable();
        $table->integer('age')->nullable();
        $table->enum('gender', ['male', 'female', 'other'])->nullable();
        $table->enum('source', ['TTP', 'Assessment', 'Measurement_Camp', 'Referral', 'Social_Media', 'Advertisement', 'Walk_In', 'Other'])->nullable();
        $table->string('source_details')->nullable();
        $table->enum('lead_stage', ['new', 'contacted', 'interested', 'qualified', 'converted', 'lost', 'hold', 'archived'])->nullable();
        $table->enum('interest_level', ['low', 'medium', 'high'])->nullable();
        $table->string('referred_by', 36)->nullable();
        $table->string('notes')->nullable();
        $table->date('last_follow_up_date')->nullable();
        $table->date('next_follow_up_date')->nullable();
        
        $table->integer('conversion_probability')->nullable();
        $table->string('converted_to_user_id', 36)->nullable();
        $table->timestamp('converted_at')->nullable();
        $table->boolean('is_active')->default(true);
        $table->timestamps();
        $table->softDeletes();
    });
);
```


## User and Prospect Shared Migritions

### Profile Details
```php
    Schema::create('profile_details', function (Blueprint $table) {
        $table->uuid('uuid')->primary();
        $table->string('first_name');
        $table->string('middle_name')->nullable();
        $table->string('last_name');
        $table->string('primary_email')->nullable();
        $table->string('primary_phone')->nullable();
        $table->date('birth_date')->nullable();
        $table->integer('birth_year')->nullable();
        $table->integer('age')->nullable();
        $table->enum('age_by', ['birth_date', 'birth_year', 'age'])->nullable();
        $table->enum('gender', ['male', 'female', 'other'])->nullable();
        $table->enum('marital_status', ['single', 'married', 'divorced', 'widowed'])->nullable();
        $table->string('occupation')->nullable();
        $table->string('mother_tongue')->nullable();
        $table->string('source')->nullable();
        $table->string('source_details')->nullable();
        $table->string('lead_stage')->nullable();
        $table->string('interest_level')->nullable();
        $table->string('coach_id')->nullable();
        $table->string('referred_by')->nullable();
        $table->string('notes')->nullable();
        $table->date('last_contact_date')->nullable();
        $table->date('next_follow_up_date')->nullable();
        $table->integer('conversion_probability')->nullable();
        $table->string('converted_to_user_id')->nullable();
        $table->timestamp('converted_at')->nullable();
        $table->boolean('is_active')->default(true);
        $table->timestamps();
        $table->softDeletes();
    });
```

### Address


### Contacts


### Health